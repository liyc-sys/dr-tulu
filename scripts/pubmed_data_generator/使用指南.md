# DR-Tulu-8B æœ¬åœ°æ¨¡å‹è½¨è¿¹ç”Ÿæˆ - ä½¿ç”¨æŒ‡å—

## åŠŸèƒ½è¯´æ˜

ä»å·²æœ‰çš„questions JSONLæ–‡ä»¶è¯»å–é—®é¢˜ï¼Œä½¿ç”¨æœ¬åœ°éƒ¨ç½²çš„DR-Tulu-8Bæ¨¡å‹ç”Ÿæˆè½¨è¿¹ï¼Œ**ä¸ç”Ÿæˆrubrics**ã€‚

## å‡†å¤‡å·¥ä½œ

### 0. å…ˆæµ‹è¯•ç¯å¢ƒï¼ˆé‡è¦ï¼ï¼‰

å»ºè®®åœ¨æ­£å¼è¿è¡Œå‰å…ˆæµ‹è¯•ï¼š

```bash
cd /workspace/math_science_data/lyc/1205/dr-tulu
source rl/open-instruct/.venv/bin/activate

# æµ‹è¯•1: MCPå·¥å…·ï¼ˆåŸæœ‰æµ‹è¯•ï¼Œä»ç„¶æœ‰æ•ˆï¼‰
python test_trajectory_tools.py

# æµ‹è¯•2: æœ¬åœ°æ¨¡å‹ï¼ˆæ–°å¢ï¼æµ‹è¯•æ‰€æœ‰8ä¸ªå®ä¾‹+å®Œæ•´è½¨è¿¹ç”Ÿæˆï¼‰
python test_local_model.py

# æµ‹è¯•3: å¿«é€ŸéªŒè¯
cd scripts/pubmed_data_generator
bash éªŒè¯ç¯å¢ƒ.sh
```

**åªæœ‰æµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼Œæ‰è¿›è¡Œåç»­æ­¥éª¤ï¼**

### 1. å¯åŠ¨æ¨¡å‹å®ä¾‹ï¼ˆåœ¨8ä¸ªtmuxçª—å£ä¸­åˆ†åˆ«è¿è¡Œï¼‰

```bash
# çª—å£0
CUDA_VISIBLE_DEVICES=0 vllm serve /workspace/math_science_data/lyc/models/DR-Tulu-8B --port 8000 --max-model-len 40960

# çª—å£1
CUDA_VISIBLE_DEVICES=1 vllm serve /workspace/math_science_data/lyc/models/DR-Tulu-8B --port 8001 --max-model-len 40960

# çª—å£2
CUDA_VISIBLE_DEVICES=2 vllm serve /workspace/math_science_data/lyc/models/DR-Tulu-8B --port 8002 --max-model-len 40960

# çª—å£3ï¼ˆæ”¹ç”¨8009ï¼Œé¿å…ä¸MCPç«¯å£8003å†²çªï¼‰
CUDA_VISIBLE_DEVICES=3 vllm serve /workspace/math_science_data/lyc/models/DR-Tulu-8B --port 8009 --max-model-len 40960

# çª—å£4-7
CUDA_VISIBLE_DEVICES=4 vllm serve /workspace/math_science_data/lyc/models/DR-Tulu-8B --port 8004 --max-model-len 40960
CUDA_VISIBLE_DEVICES=5 vllm serve /workspace/math_science_data/lyc/models/DR-Tulu-8B --port 8005 --max-model-len 40960
CUDA_VISIBLE_DEVICES=6 vllm serve /workspace/math_science_data/lyc/models/DR-Tulu-8B --port 8006 --max-model-len 40960
CUDA_VISIBLE_DEVICES=7 vllm serve /workspace/math_science_data/lyc/models/DR-Tulu-8B --port 8007 --max-model-len 40960
```

### 2. ç¡®è®¤ç¯å¢ƒæ­£å¸¸

**ä¸€é”®éªŒè¯ï¼ˆæ¨èï¼‰**ï¼š
```bash
cd /workspace/math_science_data/lyc/1205/dr-tulu/scripts/pubmed_data_generator
bash éªŒè¯ç¯å¢ƒ.sh
```

æˆ–æ‰‹åŠ¨æ£€æŸ¥ï¼š
```bash
# æ£€æŸ¥MCPæœåŠ¡å™¨
curl http://127.0.0.1:8003/mcp/health

# æ£€æŸ¥æ‰€æœ‰æ¨¡å‹å®ä¾‹
for port in 8000 8001 8002 8009 8004 8005 8006 8007; do
    curl -s http://localhost:$port/v1/models >/dev/null && echo "âœ“ $port" || echo "âœ— $port"
done
```

## ä½¿ç”¨æ–¹æ³•

### æ–¹å¼Aï¼šå¤šå®ä¾‹å¹¶è¡Œï¼ˆæ¨èï¼Œ8å€é€Ÿåº¦ï¼‰

**ä¸€æ¡å‘½ä»¤æå®š**ï¼Œè‡ªåŠ¨ä½¿ç”¨8ä¸ªGPUå¹¶è¡Œå¤„ç†ï¼š

```bash
cd /workspace/math_science_data/lyc/1205/dr-tulu/scripts/pubmed_data_generator


uv run --project /workspace/math_science_data/lyc/1205/dr-tulu/rl/open-instruct bash run_multi_instance.sh \
    /workspace/math_science_data/lyc/1205/dr-tulu/pubmed_training_data/questions_20251217_033030_no_rubrics_incremental.jsonl
```

**è¯´æ˜**ï¼š
- è‡ªåŠ¨åˆ†å‰²questionsä¸º8ä»½
- 8ä¸ªæ¨¡å‹å®ä¾‹å¹¶è¡Œå¤„ç†
- è‡ªåŠ¨åˆå¹¶ç»“æœåˆ°ä¸€ä¸ªæ–‡ä»¶
- é€Ÿåº¦ï¼š1000ä¸ªé—®é¢˜ â‰ˆ 2å°æ—¶ï¼ˆvs å•å®ä¾‹16å°æ—¶ï¼‰

### æ–¹å¼Bï¼šå•å®ä¾‹ï¼ˆæµ‹è¯•ç”¨ï¼‰

ä½¿ç”¨ä¸€ä¸ªGPUï¼š

```bash
cd /workspace/math_science_data/lyc/1205/dr-tulu/scripts/pubmed_data_generator

uv run --project /workspace/math_science_data/lyc/1205/dr-tulu/rl/open-instruct generate_trajectory_from_questions.py \
    --questions-file /workspace/math_science_data/lyc/1205/dr-tulu/pubmed_training_data/questions_20251217_033030_no_rubrics_incremental.jsonl \
    --local-model-url http://localhost:8000/v1 \
    --model-name /workspace/math_science_data/lyc/models/DR-Tulu-8B \
    --concurrency 5 \
    --limit 1 \
    --output /workspace/math_science_data/lyc/1205/dr-tulu/pubmed_training_data
```

### å‚æ•°è¯´æ˜

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `--questions-file` | questions JSONLæ–‡ä»¶è·¯å¾„ï¼ˆå¿…å¡«ï¼‰ | - |
| `--local-model-url` | æœ¬åœ°æ¨¡å‹APIåœ°å€ | `http://localhost:8000/v1` |
| `--model-name` | æ¨¡å‹åç§° | `DR-Tulu-8B` |
| `--concurrency` | å¹¶å‘æ•° | `5` |
| `--limit` | é™åˆ¶å¤„ç†æ•°é‡ï¼ˆæµ‹è¯•ç”¨ï¼‰ | `None`ï¼ˆå…¨éƒ¨ï¼‰ |

## ç›‘æ§è¿›åº¦

```bash
# å®æ—¶æŸ¥çœ‹ç”Ÿæˆçš„æ–‡ä»¶
watch -n 10 'ls -lh /workspace/math_science_data/lyc/1205/dr-tulu/pubmed_training_data/pubmed_trajectory_*.jsonl | tail -5'

# æŸ¥çœ‹æ—¥å¿—ï¼ˆå¤šå®ä¾‹æ¨¡å¼ï¼‰
tail -f /tmp/tmp.XXXXX/log_port_8000.txt
```

## è¾“å‡ºæ–‡ä»¶

åœ¨ `/workspace/math_science_data/lyc/1205/dr-tulu/pubmed_training_data/` ç›®å½•ï¼š

- **å¤šå®ä¾‹æ¨¡å¼**ï¼š`pubmed_trajectory_YYYYMMDD_HHMMSS_DR-Tulu-8B_multi_instance.jsonl`
- **å•å®ä¾‹æ¨¡å¼**ï¼š`pubmed_trajectory_YYYYMMDD_HHMMSS_DR-Tulu-8B_incremental.jsonl`
- **ç»Ÿè®¡æ–‡ä»¶**ï¼š`trajectory_stats_YYYYMMDD_HHMMSS_DR-Tulu-8B.json`

## éªŒè¯ç»“æœ

```bash
# æŸ¥çœ‹ç”Ÿæˆçš„æ ·æœ¬æ•°
cat /workspace/math_science_data/lyc/1205/dr-tulu/pubmed_training_data/pubmed_trajectory_*_multi_instance.jsonl | wc -l

# æ£€éªŒå·¥å…·è°ƒç”¨æˆåŠŸç‡
python3 /workspace/math_science_data/lyc/1205/dr-tulu/scripts/count_tool_call_success.py \
    /workspace/math_science_data/lyc/1205/dr-tulu/pubmed_training_data/pubmed_trajectory_*_multi_instance.jsonl

# æ£€éªŒæ˜¯å¦è¶…é•¿
python /workspace/math_science_data/lyc/1205/dr-tulu/äº¤ä»˜æ•°æ®/check_trajectory_token.py
```

## æµ‹è¯•ï¼ˆå¤„ç†å‰10ä¸ªé—®é¢˜ï¼‰

```bash
cd /workspace/math_science_data/lyc/1205/dr-tulu/scripts/pubmed_data_generator

source /workspace/math_science_data/lyc/1205/dr-tulu/rl/open-instruct/.venv/bin/activate

python generate_trajectory_from_questions.py \
    --questions-file /workspace/math_science_data/lyc/1205/dr-tulu/pubmed_training_data/questions_20251217_033030_no_rubrics_incremental.jsonl \
    --local-model-url http://localhost:8000/v1 \
    --model-name DR-Tulu-8B \
    --concurrency 3 \
    --limit 10
```

## å¸¸è§é—®é¢˜

**Q: æŸä¸ªæ¨¡å‹å®ä¾‹æŒ‚äº†æ€ä¹ˆåŠï¼Ÿ**
```bash
# é‡å¯å¯¹åº”çš„å®ä¾‹
CUDA_VISIBLE_DEVICES=X vllm serve /workspace/math_science_data/lyc/models/DR-Tulu-8B --port 800X --max-model-len 40960
```

**Q: å¦‚ä½•éªŒè¯æ‰€æœ‰å®ä¾‹æ­£å¸¸ï¼Ÿ**
```bash
for port in 8000 8001 8002 8009 8004 8005 8006 8007; do
    curl -s http://localhost:$port/v1/models >/dev/null && echo "âœ“ Port $port OK" || echo "âœ— Port $port FAIL"
done
```

**Q: ç”Ÿæˆå¤±è´¥äº†éƒ¨åˆ†æ•°æ®ï¼Ÿ**
- å·²ç”Ÿæˆçš„æ ·æœ¬ä¼šè‡ªåŠ¨ä¿å­˜ï¼Œä¸ä¼šä¸¢å¤±
- é‡æ–°è¿è¡Œä¼šä»å¤´å¼€å§‹ï¼Œå¯ä»¥æ‰‹åŠ¨åˆå¹¶ç»“æœ

**Q: å¦‚ä½•è°ƒæ•´é€Ÿåº¦ï¼Ÿ**
- ä¿®æ”¹ `run_multi_instance.sh` ç¬¬14è¡Œçš„ `CONCURRENCY_PER_INSTANCE`
- é»˜è®¤3ï¼Œå¯æ”¹ä¸º5-8ï¼ˆå¦‚æœGPUå†…å­˜è¶³å¤Ÿï¼‰

## å®Œæ•´å·¥ä½œæµ

```bash
# 1. å¯åŠ¨æ‰€æœ‰æ¨¡å‹å®ä¾‹ï¼ˆ8ä¸ªtmuxçª—å£ï¼‰

# 2. éªŒè¯å®ä¾‹
for port in 8000 8001 8002 8009 8004 8005 8006 8007; do
    curl -s http://localhost:$port/v1/models >/dev/null && echo "âœ“ $port" || echo "âœ— $port"
done

# 3. éªŒè¯MCP
curl http://127.0.0.1:8003/mcp/health

# 4. è¿›å…¥å·¥ä½œç›®å½•å¹¶æ¿€æ´»ç¯å¢ƒ
cd /workspace/math_science_data/lyc/1205/dr-tulu/scripts/pubmed_data_generator
source /workspace/math_science_data/lyc/1205/dr-tulu/rl/open-instruct/.venv/bin/activate

# 5. è¿è¡Œç”Ÿæˆï¼ˆå¤šå®ä¾‹ï¼‰
bash run_multi_instance.sh \
    /workspace/math_science_data/lyc/1205/dr-tulu/pubmed_training_data/questions_20251217_033030_no_rubrics_incremental.jsonl

# 6. ç›‘æ§ï¼ˆæ–°çª—å£ï¼‰
watch -n 10 'ls -lh /workspace/math_science_data/lyc/1205/dr-tulu/pubmed_training_data/*.jsonl | tail -10'

# 7. éªŒè¯ç»“æœ
cat /workspace/math_science_data/lyc/1205/dr-tulu/pubmed_training_data/pubmed_trajectory_*_multi_instance.jsonl | wc -l
python3 /workspace/math_science_data/lyc/1205/dr-tulu/scripts/count_tool_call_success.py \
    /workspace/math_science_data/lyc/1205/dr-tulu/pubmed_training_data/pubmed_trajectory_*_multi_instance.jsonl
```

---

**å°±è¿™ä¸€ä¸ªæ–‡æ¡£ï¼Œå¤Ÿç”¨äº†ï¼** ğŸ¯

