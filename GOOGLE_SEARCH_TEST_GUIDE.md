# Google æœç´¢å·¥å…·æµ‹è¯•æŒ‡å—

## ğŸ“¦ æµ‹è¯•è„šæœ¬è¯´æ˜

å·²ä¸ºä½ åˆ›å»ºäº† **3 ä¸ªæµ‹è¯•è„šæœ¬**ï¼Œä»ç®€å•åˆ°å¤æ‚ï¼š

### 1ï¸âƒ£ `test_google_search.py` - åŸºç¡€æµ‹è¯•
**æœ€ç®€å•çš„æµ‹è¯•**ï¼Œç›´æ¥æµ‹è¯•æœç´¢åŠŸèƒ½ã€‚

```bash
python test_google_search.py
```

**åŠŸèƒ½ï¼š**
- æµ‹è¯•åŸºæœ¬çš„æœç´¢åŠŸèƒ½
- æ˜¾ç¤ºå‰ 5 ä¸ªæœç´¢ç»“æœ
- é€‚åˆå¿«é€ŸéªŒè¯å·¥å…·æ˜¯å¦æ­£å¸¸å·¥ä½œ

### 2ï¸âƒ£ `test_google_search_with_parser.py` - å·¥å…·è°ƒç”¨æ ¼å¼æµ‹è¯•
**æ¨¡æ‹Ÿè®­ç»ƒåœºæ™¯**ï¼Œä½¿ç”¨å·¥å…·è°ƒç”¨æ ¼å¼ã€‚

```bash
python test_google_search_with_parser.py
```

**åŠŸèƒ½ï¼š**
- ä½¿ç”¨ `<tool_call>` æ ¼å¼ï¼ˆä¸è®­ç»ƒæ—¶æ¨¡å‹ç”Ÿæˆçš„æ ¼å¼ç›¸åŒï¼‰
- æµ‹è¯•å·¥å…·è§£æå™¨ï¼ˆparserï¼‰
- æ˜¾ç¤ºæ ¼å¼åŒ–è¾“å‡ºï¼ˆè¿”å›ç»™æ¨¡å‹çš„å†…å®¹ï¼‰
- **æœ€æ¥è¿‘çœŸå®è®­ç»ƒåœºæ™¯**

### 3ï¸âƒ£ `test_google_search_multi.py` - å¤šæŸ¥è¯¢æµ‹è¯•
**æ‰¹é‡æµ‹è¯•å¤šä¸ªæŸ¥è¯¢**ã€‚

```bash
python test_google_search_multi.py
```

**åŠŸèƒ½ï¼š**
- è¿ç»­æµ‹è¯•å¤šä¸ªæŸ¥è¯¢
- æ¯”è¾ƒä¸åŒæŸ¥è¯¢çš„ç»“æœ
- é€‚åˆå‹åŠ›æµ‹è¯•å’Œæ€§èƒ½æµ‹è¯•

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ­¥éª¤ 1: å¯åŠ¨ MCP æœåŠ¡å™¨

æ‰“å¼€ç»ˆç«¯ 1ï¼š

```bash
cd /Users/liyc/Desktop/dr-tulu/agent

# å¯åŠ¨ MCP æœåŠ¡å™¨
uv run python -m dr_agent.mcp_backend.main \
  --transport http \
  --port 8003 \
  --host 0.0.0.0 \
  --path /mcp
```

çœ‹åˆ°ä»¥ä¸‹è¾“å‡ºè¡¨ç¤ºæˆåŠŸï¼š
```
INFO:     Started server process
INFO:     Uvicorn running on http://0.0.0.0:8003
```

### æ­¥éª¤ 2: è¿è¡Œæµ‹è¯•

æ‰“å¼€ç»ˆç«¯ 2ï¼š

```bash
cd /Users/liyc/Desktop/dr-tulu

# åŸºç¡€æµ‹è¯•
python test_google_search.py

# æˆ–å·¥å…·è°ƒç”¨æ ¼å¼æµ‹è¯•ï¼ˆæ¨èï¼‰
python test_google_search_with_parser.py

# æˆ–å¤šæŸ¥è¯¢æµ‹è¯•
python test_google_search_multi.py
```

## ğŸ“Š é¢„æœŸè¾“å‡º

### åŸºç¡€æµ‹è¯•è¾“å‡ºç¤ºä¾‹

```
============================================================
Google æœç´¢å·¥å…·æµ‹è¯•
============================================================

åˆ›å»º Google æœç´¢å·¥å…·...
âœ“ å·¥å…·åˆ›å»ºæˆåŠŸ

æœç´¢: äººå·¥æ™ºèƒ½æœ€æ–°è¿›å±•
------------------------------------------------------------

æœç´¢ç»“æœ:
  è°ƒç”¨æˆåŠŸ: True
  é”™è¯¯ä¿¡æ¯: æ— 
  è€—æ—¶: 1.23ç§’
  æ–‡æ¡£æ•°: 10

å‰ 5 ä¸ªæœç´¢ç»“æœ:

1. äººå·¥æ™ºèƒ½æŠ€æœ¯å‘å±•è¶‹åŠ¿åˆ†æ
   URL: https://example.com/ai-trends
   æ‘˜è¦: 2024å¹´äººå·¥æ™ºèƒ½é¢†åŸŸå–å¾—äº†é‡å¤§çªç ´...

2. AIæœ€æ–°ç ”ç©¶æˆæœæ±‡æ€»
   URL: https://example.com/ai-research
   æ‘˜è¦: æ·±åº¦å­¦ä¹ ã€å¼ºåŒ–å­¦ä¹ ç­‰æŠ€æœ¯ä¸æ–­è¿›æ­¥...

...

============================================================
âœ“ æµ‹è¯•å®Œæˆ
```

### å·¥å…·è°ƒç”¨æ ¼å¼æµ‹è¯•è¾“å‡ºç¤ºä¾‹

```
============================================================
Google æœç´¢ - å·¥å…·è°ƒç”¨æ ¼å¼æµ‹è¯•
============================================================

åˆ›å»ºå·¥å…·å®ä¾‹...
âœ“ å·¥å…·åˆ›å»ºæˆåŠŸ

å·¥å…·è°ƒç”¨æ–‡æœ¬:
  <tool_call name="google_search" num_results="5">æœºå™¨å­¦ä¹ åœ¨åŒ»ç–—ä¸­çš„åº”ç”¨</tool_call>

------------------------------------------------------------

æœç´¢ç»“æœ:
  æˆåŠŸ: True
  é”™è¯¯: æ— 
  è€—æ—¶: 1.15ç§’
  ç»“æœæ•°: 5
  æŸ¥è¯¢: æœºå™¨å­¦ä¹ åœ¨åŒ»ç–—ä¸­çš„åº”ç”¨

æœç´¢ç»“æœè¯¦æƒ…:

1. ã€æœºå™¨å­¦ä¹ åœ¨åŒ»ç–—è¯Šæ–­ä¸­çš„åº”ç”¨ã€‘
   ğŸ”— https://example.com/ml-medical
   ğŸ“ æœºå™¨å­¦ä¹ æŠ€æœ¯æ­£åœ¨revolutionizeåŒ»ç–—è¡Œä¸š...

============================================================
æ ¼å¼åŒ–è¾“å‡ºï¼ˆè¿”å›ç»™æ¨¡å‹ï¼‰:

<snippet id=abc123-0>
Title: æœºå™¨å­¦ä¹ åœ¨åŒ»ç–—è¯Šæ–­ä¸­çš„åº”ç”¨
URL: https://example.com/ml-medical
Snippet: æœºå™¨å­¦ä¹ æŠ€æœ¯æ­£åœ¨revolutionizeåŒ»ç–—è¡Œä¸š...
</snippet>

...

============================================================
âœ“ æµ‹è¯•å®Œæˆ
```

## ğŸ” å·¥å…·è°ƒç”¨æ ¼å¼è¯´æ˜

åœ¨è®­ç»ƒä¸­ï¼Œæ¨¡å‹ä¼šç”Ÿæˆè¿™æ ·çš„å·¥å…·è°ƒç”¨ï¼š

```xml
<tool_call name="google_search" num_results="10">ä½ çš„æŸ¥è¯¢</tool_call>
```

**å‚æ•°è¯´æ˜ï¼š**
- `name`: å·¥å…·åç§°ï¼Œå›ºå®šä¸º `"google_search"`
- `num_results`: è¿”å›ç»“æœæ•°é‡ï¼ˆå¯é€‰ï¼Œé»˜è®¤ 10ï¼‰
- æ ‡ç­¾å†…å®¹: æœç´¢æŸ¥è¯¢

**å…¶ä»–å¯é€‰å‚æ•°ï¼š**
- `gl`: åœ°ç†ä½ç½®ï¼ˆå¦‚ `"us"`, `"cn"`ï¼‰
- `hl`: è¯­è¨€ï¼ˆå¦‚ `"en"`, `"zh"`ï¼‰

ç¤ºä¾‹ï¼š
```xml
<tool_call name="google_search" num_results="5" gl="cn" hl="zh">æ·±åº¦å­¦ä¹ </tool_call>
```

## ğŸ› ï¸ æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: Connection refused

**åŸå› ï¼š** MCP æœåŠ¡å™¨æœªå¯åŠ¨

**è§£å†³ï¼š**
```bash
cd agent
uv run python -m dr_agent.mcp_backend.main --transport http --port 8003 --host 0.0.0.0 --path /mcp
```

### é—®é¢˜ 2: ImportError

**åŸå› ï¼š** ç¼ºå°‘ä¾èµ–

**è§£å†³ï¼š**
```bash
cd agent
uv sync
```

### é—®é¢˜ 3: SERPER_API_KEY é”™è¯¯

**åŸå› ï¼š** ç¼ºå°‘ Serper API Key

**è§£å†³ï¼š**
```bash
export SERPER_API_KEY=your_api_key_here
```

æˆ–åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.env` æ–‡ä»¶ï¼š
```
SERPER_API_KEY=your_api_key_here
```

### é—®é¢˜ 4: è¶…æ—¶é”™è¯¯

**åŸå› ï¼š** ç½‘ç»œé—®é¢˜æˆ– API å“åº”æ…¢

**è§£å†³ï¼š** å¢åŠ è¶…æ—¶æ—¶é—´
```python
tool = SerperSearchTool(
    timeout=120,  # å¢åŠ åˆ° 120 ç§’
    ...
)
```

## ğŸ“ è‡ªå®šä¹‰æµ‹è¯•

### ä¿®æ”¹æŸ¥è¯¢

ç¼–è¾‘æµ‹è¯•è„šæœ¬ä¸­çš„æŸ¥è¯¢ï¼š

```python
# test_google_search.py ç¬¬ 28 è¡Œ
query = "ä½ çš„æŸ¥è¯¢å†…å®¹"

# test_google_search_multi.py ç¬¬ 42-46 è¡Œ
queries = [
    "æŸ¥è¯¢1",
    "æŸ¥è¯¢2",
    "æŸ¥è¯¢3",
]
```

### ä¿®æ”¹ç»“æœæ•°é‡

```python
tool = SerperSearchTool(
    number_documents_to_search=20,  # æ”¹ä¸º 20 ä¸ªç»“æœ
    ...
)
```

### æ·»åŠ åœ°ç†ä½ç½®è¿‡æ»¤

```python
result = await tool({
    "query": "restaurants", 
    "num_results": 10,
    "gl": "us",  # ç¾å›½
    "hl": "en"   # è‹±è¯­
})
```

## ğŸ¯ è¿›é˜¶ï¼šé›†æˆæµ‹è¯•

æµ‹è¯•æœç´¢ + æµè§ˆçš„å®Œæ•´æµç¨‹ï¼š

```python
from dr_agent.tool_interface.mcp_tools import SerperSearchTool, Crawl4AIBrowseTool

async def test_search_and_browse():
    # 1. æœç´¢
    search_tool = SerperSearchTool(...)
    search_result = await search_tool({"query": "Pythonæ•™ç¨‹"})
    
    # 2. æµè§ˆç¬¬ä¸€ä¸ªç»“æœ
    browse_tool = Crawl4AIBrowseTool(...)
    browse_result = await browse_tool(search_result)  # ç›´æ¥ä¼ å…¥æœç´¢ç»“æœ
    
    print(browse_result.output)
```

## ğŸ” API Key é…ç½®

Google æœç´¢å·¥å…·ä½¿ç”¨ **Serper API**ï¼š

1. è·å– API Key: https://serper.dev/
2. è®¾ç½®ç¯å¢ƒå˜é‡ï¼š
   ```bash
   export SERPER_API_KEY=your_key_here
   ```
3. æˆ–åœ¨ `.env` æ–‡ä»¶ä¸­é…ç½®

## ğŸ“š ç›¸å…³æ–‡ä»¶

- **å·¥å…·å®ç°**: `agent/dr_agent/tool_interface/mcp_tools.py` (SerperSearchTool)
- **MCP åç«¯**: `agent/dr_agent/mcp_backend/main.py` (serper_google_webpage_search)
- **API å®ç°**: `agent/dr_agent/mcp_backend/apis/serper_apis.py`
- **è®­ç»ƒé…ç½®**: `rl/open-instruct/train_dr_tulu.sh` (ç¬¬ 138 è¡Œ)

## ğŸ“ ä¸‹ä¸€æ­¥

1. âœ… è¿è¡ŒåŸºç¡€æµ‹è¯•ç¡®è®¤å·¥å…·æ­£å¸¸
2. âœ… è¿è¡Œå·¥å…·è°ƒç”¨æ ¼å¼æµ‹è¯•ï¼ˆæœ€é‡è¦ï¼‰
3. âœ… åœ¨è®­ç»ƒè„šæœ¬ä¸­å¯ç”¨å·¥å…·
4. ğŸš€ å¼€å§‹è®­ç»ƒï¼

éœ€è¦å¸®åŠ©ï¼ŸæŸ¥çœ‹ `PUBMED_TOOL_USAGE.md` äº†è§£æ›´å¤šå·¥å…·ä½¿ç”¨æ–¹æ³•ã€‚

